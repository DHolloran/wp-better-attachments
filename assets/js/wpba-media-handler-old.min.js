/**
* Updates Sort Order
*/function wpbaUpdateSortOrder(e){var t=jQuery,n=e.find("li"),r=[],i={action:"wpba_update_sort_order"},s=t(".wpba-saving");n.each(function(){var e=t(this);r.push(e.data("id"))});i.attids=r;s.removeClass("hide");t.post(ajaxurl,i,function(e){s.addClass("hide");return!1})}function wpbawpbaUpdateSortOrderClickHandler(){var e=jQuery,t=e("#wpba_image_sortable");t.sortable();t.disableSelection();t.on("sortupdate",function(e,n){wpbaUpdateSortOrder(t)})}function wpbaUnattachAttachment(e){var t=jQuery,n=t("#wpba_image_sortable"),r=e.parent("li").parent("ul"),i=r.data("id"),s={action:"wpba_unattach_attachment",attachmentid:i},o=t(".wpba-saving");o.removeClass("hide");t.post(ajaxurl,s,function(e){var i=t.parseJSON(e);if(i){r.parent("li").remove();wpbaUpdateSortOrder(n)}})}function wpbawpbaUnattachAttachmentClickHandler(){$=jQuery;$(".wpba-unattach").on("click",function(e){wpbaUnattachAttachment($(this));e.preventDefault();return!1})}function wpbawpbaUnattachAttachmentLibraryClickHandler(){$=jQuery;$(".wpba-unattach-library").on("click",function(e){var t=$(this),n=t.data("id"),r={action:"wpba_unattach_attachment",attachmentid:n};$.post(ajaxurl,r,function(e){var t=$.parseJSON(e);if(t){$("#post-"+n+" .reattach").remove();$("#post-"+n+" .unattach").remove();$("#post-"+n+" .view").empty().append('<a href="http://localhost/~mothership/plugin-dev/?attachment_id='+n+'" title="View “Hello world!”" rel="permalink">View</a>');$("#post-"+n+" .column-parent").empty().append("(Unattached)<br><a class=\"hide-if-no-js\" onclick=\"findPosts.open( 'media[]','"+n+"'"+' ); return false;" href="#the-list">Attach</a>')}});e.preventDefault();return!1})}function wpbaDeleteAttachment(e){var t=jQuery,n=confirm("Are you sure you want to permanently delete this attachment? This will permanently remove the attachment from the media gallery!!"),r=t(".wpba-saving"),i=t("#wpba_image_sortable");if(n){var s=e.parent("li").parent("ul"),o=s.data("id"),u={action:"wpba_delete_attachment",attachmentid:o};r.removeClass("hide");t.post(ajaxurl,u,function(e){var n=t.parseJSON(e);if(n){s.parent("li").remove();wpbaUpdateSortOrder(i)}r.addClass("hide")})}}function wpbawpbaDeleteAttachmentClickHandler(){$=jQuery;$(".wpba-delete").on("click",function(e){wpbaDeleteAttachment($(this));e.preventDefault();return!1})}function wpbaRefreshAttachments(e){var t=jQuery,n={action:"wpba_refresh_attachments",postid:t(".wpba").data("postid")},r=t("#wpba_image_sortable");t.getJSON(ajaxurl,n,function(e){r.empty().append(e);wpbaResetClickHandlers()});return!1}function wpbaEditModalClickHandler(){$=jQuery;if($("#wpba_edit_screen").length>0){$(".wpba-edit").on("click",function(e){var t=$(this);attid=wpbaShowEditScreenModal(t);e.preventDefault();return!1});$("#wpba_edit_screen_close").on("click",function(e){var t=$(this);wpbaRefreshAttachments(attid);$("#wpba_edit_screen").hide();e.preventDefault();return!1})}}function wpbaShowEditScreenModal(e){var t=$("#wpba_edit_screen"),n=t.find("iframe"),r;n.attr("src",e.attr("href"));n.load(function(){css="#adminmenuwrap,#adminmenuback,#wpadminbar,#screen-meta-links,#wpfooter,.add-new-h2 { display: none; }#wpcontent { width: 96%; margin: 0 2%; }";n.contents().find("head").append($("<style type='text/css'>"+css+"</style>"));r=n.contents().find("#post_ID").val();n.contents().find("#publish").on("click",function(){n.hide();n.load(function(){n.contents().find("head").append($("<style type='text/css'>"+css+"</style>"));n.show()})});t.show();return r})}function wpbaUpdatePostMeta(e,t,n,r){var i=jQuery,r=r!=undefined?r:!1;ajaxData={action:"wpba_update_post_meta",meta_key:t,meta_value:n,prev_value:r};i.post(ajaxurl,ajaxData,function(e){console.log(e)})}function wpbaUpdatePostMetaClickHandler(){$("wpba-post-meta").on("change",function(){})}function wpbaResetClickHandlers(){wpbawpbaUpdateSortOrderClickHandler();wpbawpbaUnattachAttachmentClickHandler();wpbawpbaUnattachAttachmentLibraryClickHandler();wpbawpbaDeleteAttachmentClickHandler();wpbaEditModalClickHandler();wpbaUpdatePostMetaClickHandler()}jQuery(function(e){e(window).load(function(){wpbawpbaUpdateSortOrderClickHandler();wpbawpbaUnattachAttachmentClickHandler();wpbawpbaUnattachAttachmentLibraryClickHandler();wpbawpbaDeleteAttachmentClickHandler();wpbaEditModalClickHandler();wpbaUpdatePostMetaClickHandler()})}(jQuery));jQuery(function(e){e(window).load(function(){e("#wpba_attachments_button").on("click",function(){tb_show("","media-upload.php?type=image&amp;TB_iframe=true");window.original_send_to_editor=window.send_to_editor;window.send_to_editor=function(t){imgurl=jQuery(t).attr("src");imgurl||(imgurl=jQuery("img",t).attr("src"));imgurl||(imgurl=jQuery(t).attr("href"));var n=e("#wpba_image_sortable"),r=e(".wpba-saving"),i={attachmenturl:imgurl,action:"wpba_add_attachment_old",parentid:e(".wpba").data("postid")};r.removeClass("hide");e.post(ajaxurl,i,function(t){resp=e.parseJSON(t);if(resp){n.append(resp.image);wpbaUpdateSortOrder(n);wpbaResetClickHandlers()}});tb_remove();window.send_to_editor=window.original_send_to_editor};return!1})})}(jQuery));