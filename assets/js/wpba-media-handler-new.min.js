jQuery(function(e){e(window).load(function(){function s(t){var n=t.find("li"),r=[],i={action:"wpba_update_sort_order"};n.each(function(){var t=e(this);r.push(t.data("id"))});i.attids=r;e.post(ajaxurl,i,function(e){return!1})}function o(n){var r=n.parent("li").parent("ul"),i=r.data("id"),o={action:"wpba_unattach_image",attachmentid:i};e.post(ajaxurl,o,function(n){var i=e.parseJSON(n);if(i){r.parent("li").remove();s(t)}})}function u(n){var r=confirm("Are you sure you want to permanently delete this attachment? This will permanently remove the attachment from the media gallery!!");if(r){var i=n.parent("li").parent("ul"),o=i.data("id"),u={action:"wpba_delete_attachment",attachmentid:o};e.post(ajaxurl,u,function(n){var r=e.parseJSON(n);if(r){i.parent("li").remove();s(t)}})}}var t=e("#wpba_sortable"),n=e(".wpba-unattach"),r=e(".wpba-delete"),i;t.sortable();t.disableSelection();t.on("sortupdate",function(e,n){s(t)});s(t);n.on("click",function(t){o(e(this));t.preventDefault();return!1});e("#wpba_attachments_button").on("click",function(n){n.preventDefault();if(i){i.open();return}i=wp.media.frames.file_frame=wp.media({title:e(this).data("uploader_title"),button:{text:e(this).data("uploader_button_text")},multiple:!0});i.on("select",function(){var n=i.state().get("selection").toJSON(),r={attachments:n,action:"wpba_add_attachment",parentid:e(".wpba").data("postid")};console.log(n);e.post(ajaxurl,r,function(n){resp=e.parseJSON(n);if(resp){t.append(resp);e(".wpba-unattach").on("click",function(t){o(e(this));t.preventDefault();return!1})}})});i.open()});r.on("click",function(t){u(e(this));t.preventDefault();return!1})})}(jQuery));